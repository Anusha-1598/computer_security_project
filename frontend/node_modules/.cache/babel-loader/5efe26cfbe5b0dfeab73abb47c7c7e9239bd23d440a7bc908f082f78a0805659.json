{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import\"./ViewDocument.css\";import{setLoginUser}from\"../redux/loginSlice\";import io from\"socket.io-client\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const socket=io.connect(\"http://localhost:3001\");const ViewDocument=()=>{const currentUser=useSelector(state=>state.login.loginUser);// const currentUser = \"chandu\";\nconst[content,setContent]=useState(\"\");const currentDocument=useSelector(state=>state.documents.currentDocument);const dispatch=useDispatch();const[roomMessage,setRoomMessage]=useState(\"\");const joinRoom=()=>{if(currentDocument.fileId!==\"\"){socket.emit(\"join_room\",{fileId:currentDocument.fileId,userId:currentUser});}};const sendMessage=content=>{socket.emit(\"send_message\",{userId:currentUser,fileId:currentDocument.fileId,content:content});};useEffect(()=>{socket.on(\"receive_message\",data=>{if(data.roomMessage){setRoomMessage(data.roomMessage);}if(data.userId&&data.newContent){setContent(data.newContent);}});},[socket]);useEffect(()=>{fetch(\"http://127.0.0.1:5000/verifyCookie\",{method:\"POST\"}).then(res=>{if(res.status===200){res.json().then(res=>{dispatch(setLoginUser(res.userId));if(currentDocument){fetch(\"http://127.0.0.1:5000/getDocumentContent\",{method:\"POST\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:currentUser,fileId:currentDocument.fileId})}).then(res=>{if(res.status===200){res.json().then(res=>{setContent(res.fileContent);joinRoom();});}else{res.json().then(res=>{alert(res.message);});}}).catch(err=>{alert(\"Failed to fetch the document content due to : \\n\",err.message);});}});}else{let goToLogin=()=>dispatch(\"/login\");goToLogin();dispatch(setLoginUser(\"\"));}}).catch(err=>{alert(err.message);});},[]);if(!currentDocument){return/*#__PURE__*/_jsx(\"div\",{children:\"No document selected\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"view-document\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"document-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Document Viewer\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File Name:\"}),\" \",currentDocument.fileName]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File ID:\"}),\" \",currentDocument.fileId]}),currentDocument.ownerName&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Owner:\"}),\" \",currentDocument.ownerName]}),roomMessage.length!==0?/*#__PURE__*/_jsx(\"p\",{children:roomMessage}):/*#__PURE__*/_jsx(_Fragment,{}),currentDocument.sharedUsers&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Shared With:\"}),/*#__PURE__*/_jsx(\"ul\",{children:currentDocument.sharedUsers.map((user,index)=>/*#__PURE__*/_jsxs(\"li\",{children:[user.userId,\" - \",user.permissions.join(\", \")]},index))})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"viewer\",children:/*#__PURE__*/_jsx(\"textarea\",{className:\"viewer-textarea\",value:content,readOnly:true})})]});};export default ViewDocument;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","setLoginUser","io","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","socket","connect","ViewDocument","currentUser","state","login","loginUser","content","setContent","currentDocument","documents","dispatch","roomMessage","setRoomMessage","joinRoom","fileId","emit","userId","sendMessage","on","data","newContent","fetch","method","then","res","status","json","credentials","headers","body","JSON","stringify","fileContent","alert","message","catch","err","goToLogin","children","className","fileName","ownerName","length","sharedUsers","map","user","index","permissions","join","value","readOnly"],"sources":["/workspaces/computer_security_project/frontend/src/components/ViewDocument.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport \"./ViewDocument.css\";\nimport { setLoginUser } from \"../redux/loginSlice\";\nimport io from \"socket.io-client\";\nconst socket = io.connect(\"http://localhost:3001\");\n\nconst ViewDocument = () => {\n  const currentUser = useSelector((state) => state.login.loginUser);\n  // const currentUser = \"chandu\";\n  const [content, setContent] = useState(\"\");\n  const currentDocument = useSelector(\n    (state) => state.documents.currentDocument\n  );\n  const dispatch = useDispatch();\n  const [roomMessage, setRoomMessage] = useState(\"\");\n\n  const joinRoom = () => {\n    if (currentDocument.fileId !== \"\") {\n      socket.emit(\"join_room\", {\n        fileId: currentDocument.fileId,\n        userId: currentUser,\n      });\n    }\n  };\n\n  const sendMessage = (content) => {\n    socket.emit(\"send_message\", {\n      userId: currentUser,\n      fileId: currentDocument.fileId,\n      content: content,\n    });\n  };\n\n  useEffect(() => {\n    socket.on(\"receive_message\", (data) => {\n      if (data.roomMessage) {\n        setRoomMessage(data.roomMessage);\n      }\n      if (data.userId && data.newContent) {\n        setContent(data.newContent);\n      }\n    });\n  }, [socket]);\n\n  useEffect(() => {\n    fetch(\"http://127.0.0.1:5000/verifyCookie\", {\n      method: \"POST\",\n    })\n      .then((res) => {\n        if (res.status === 200) {\n          res.json().then((res) => {\n            dispatch(setLoginUser(res.userId));\n            if (currentDocument) {\n              fetch(\"http://127.0.0.1:5000/getDocumentContent\", {\n                method: \"POST\",\n                credentials: \"include\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                },\n                body: JSON.stringify({\n                  userId: currentUser,\n                  fileId: currentDocument.fileId,\n                }),\n              })\n                .then((res) => {\n                  if (res.status === 200) {\n                    res.json().then((res) => {\n                      setContent(res.fileContent);\n                      joinRoom();\n                    });\n                  } else {\n                    res.json().then((res) => {\n                      alert(res.message);\n                    });\n                  }\n                })\n                .catch((err) => {\n                  alert(\n                    \"Failed to fetch the document content due to : \\n\",\n                    err.message\n                  );\n                });\n            }\n          });\n        } else {\n          let goToLogin = () => dispatch(\"/login\");\n          goToLogin();\n          dispatch(setLoginUser(\"\"));\n        }\n      })\n      .catch((err) => {\n        alert(err.message);\n      });\n  }, []);\n\n  if (!currentDocument) {\n    return <div>No document selected</div>;\n  }\n\n  return (\n    <div className=\"view-document\">\n      <div className=\"document-info\">\n        <h2>Document Viewer</h2>\n        <p>\n          <strong>File Name:</strong> {currentDocument.fileName}\n        </p>\n        <p>\n          <strong>File ID:</strong> {currentDocument.fileId}\n        </p>\n        {currentDocument.ownerName && (\n          <p>\n            <strong>Owner:</strong> {currentDocument.ownerName}\n          </p>\n        )}\n        {roomMessage.length !== 0 ? <p>{roomMessage}</p> : <></>}\n        {currentDocument.sharedUsers && (\n          <div>\n            <strong>Shared With:</strong>\n            <ul>\n              {currentDocument.sharedUsers.map((user, index) => (\n                <li key={index}>\n                  {user.userId} - {user.permissions.join(\", \")}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n      <div className=\"viewer\">\n        <textarea\n          className=\"viewer-textarea\"\n          value={content}\n          readOnly\n        ></textarea>\n      </div>\n    </div>\n  );\n};\n\nexport default ViewDocument;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}