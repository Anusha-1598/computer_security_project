{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{updateDocumentContent}from\"../redux/documentsSlice\";import\"./EditDocument.css\";import io from\"socket.io-client\";import{setLoginUser}from\"../redux/loginSlice\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const socket=io.connect(\"http://localhost:3001\");const EditDocument=()=>{const currentUser=useSelector(state=>state.login.loginUser);// const currentUser = \"chandu\";\nconst currentDocument=useSelector(state=>state.documents.currentDocument);const dispatch=useDispatch();const[content,setContent]=useState(\"\");const[acknowledgment,setAcknowledgment]=useState(\"\");const[roomMessage,setRoomMessage]=useState(\"\");const joinRoom=()=>{if(currentDocument.fileId!==\"\"){socket.emit(\"join_room\",{fileId:currentDocument.fileId,userId:currentUser});}};const sendMessage=content=>{socket.emit(\"send_message\",{userId:currentUser,fileId:currentDocument.fileId,content:content});};useEffect(()=>{socket.on(\"receive_message\",data=>{if(data.roomMessage){setRoomMessage(data.roomMessage);}if(data.userId&&data.newContent){setContent(data.newContent);}});},[socket]);useEffect(()=>{fetch(\"http://127.0.0.1:5000/verifyCookie\",{method:\"POST\",credentials:\"include\"}).then(res=>{if(res.status===200){res.json().then(res=>{dispatch(setLoginUser(res.userId));if(currentDocument){fetch(\"http://127.0.0.1:5000/getDocumentContent\",{method:\"POST\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:currentUser,fileId:currentDocument.fileId})}).then(res=>{if(res.status===200){res.json().then(res=>{setContent(res.fileContent);joinRoom();//if join room doesnt work just place join room as callback here and make apio call in joinroom\n});}else{res.json().then(res=>{alert(res.message);});}}).catch(err=>{alert(\"Failed to ftech the document content due to : \\n\",err.message);});}});}else{let goToLogin=()=>dispatch(\"/login\");goToLogin();dispatch(setLoginUser(\"\"));}}).catch(err=>{alert(err.message);});},[]);if(!currentDocument){return/*#__PURE__*/_jsx(\"div\",{children:\"No document selected\"});}const handleContentChange=e=>{setContent(e.target.value);sendMessage(e.target.value);};const handleSave=()=>{fetch(\"http://127.0.0.1:5000/saveDocumentContent\",{method:\"POST\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:currentUser,content:content,fileId:currentDocument.fileId})}).then(res=>{if(res.status===200){res.json().then(res=>{dispatch(updateDocumentContent({fileId:currentDocument.fileId,newContent:content}));setAcknowledgment(res.message);setTimeout(()=>setAcknowledgment(\"\"),3000);});}else{res.json().then(res=>{alert(res.message);});}});};return/*#__PURE__*/_jsxs(\"div\",{className:\"edit-document\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"document-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Document Editor\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File Name:\"}),\" \",currentDocument.fileName]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File ID:\"}),\" \",currentDocument.fileId]}),currentDocument.ownerName&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Owner:\"}),\" \",currentDocument.ownerName]}),roomMessage.length!==0?/*#__PURE__*/_jsx(\"p\",{children:roomMessage}):/*#__PURE__*/_jsx(_Fragment,{}),currentDocument.sharedUsers&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Shared With:\"}),/*#__PURE__*/_jsx(\"ul\",{children:currentDocument.sharedUsers.map((user,index)=>/*#__PURE__*/_jsxs(\"li\",{children:[user.userId,\" - \",user.permissions.join(\", \")]},index))})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editor\",children:/*#__PURE__*/_jsx(\"textarea\",{className:\"editor-textarea\",placeholder:\"Start writing your document here...\",value:content,onChange:handleContentChange})}),/*#__PURE__*/_jsx(\"div\",{className:\"editor-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"save-button\",onClick:handleSave,children:\"Save\"})}),acknowledgment&&/*#__PURE__*/_jsx(\"div\",{className:\"acknowledgment\",children:acknowledgment})]});};export default EditDocument;// https://codesandbox.io/s/slate-react-rich-text-editor-fbqre?file=/src/App.js","map":{"version":3,"names":["React","useState","useEffect","useSelector","useDispatch","updateDocumentContent","io","setLoginUser","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","socket","connect","EditDocument","currentUser","state","login","loginUser","currentDocument","documents","dispatch","content","setContent","acknowledgment","setAcknowledgment","roomMessage","setRoomMessage","joinRoom","fileId","emit","userId","sendMessage","on","data","newContent","fetch","method","credentials","then","res","status","json","headers","body","JSON","stringify","fileContent","alert","message","catch","err","goToLogin","children","handleContentChange","e","target","value","handleSave","setTimeout","className","fileName","ownerName","length","sharedUsers","map","user","index","permissions","join","placeholder","onChange","onClick"],"sources":["/workspaces/computer_security_project/frontend/src/components/EditDocument.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { updateDocumentContent } from \"../redux/documentsSlice\";\nimport \"./EditDocument.css\";\nimport io from \"socket.io-client\";\nimport { setLoginUser } from \"../redux/loginSlice\";\nconst socket = io.connect(\"http://localhost:3001\");\n\nconst EditDocument = () => {\n  const currentUser = useSelector((state) => state.login.loginUser);\n  // const currentUser = \"chandu\";\n  const currentDocument = useSelector(\n    (state) => state.documents.currentDocument\n  );\n  const dispatch = useDispatch();\n  const [content, setContent] = useState(\"\");\n  const [acknowledgment, setAcknowledgment] = useState(\"\");\n  const [roomMessage, setRoomMessage] = useState(\"\");\n\n  const joinRoom = () => {\n    if (currentDocument.fileId !== \"\") {\n      socket.emit(\"join_room\", {\n        fileId: currentDocument.fileId,\n        userId: currentUser,\n      });\n    }\n  };\n\n  const sendMessage = (content) => {\n    socket.emit(\"send_message\", {\n      userId: currentUser,\n      fileId: currentDocument.fileId,\n      content: content,\n    });\n  };\n\n  useEffect(() => {\n    socket.on(\"receive_message\", (data) => {\n      if (data.roomMessage) {\n        setRoomMessage(data.roomMessage);\n      }\n      if (data.userId && data.newContent) {\n        setContent(data.newContent);\n      }\n    });\n  }, [socket]);\n\n  useEffect(() => {\n    fetch(\"http://127.0.0.1:5000/verifyCookie\", {\n      method: \"POST\",\n      credentials: \"include\",\n    })\n      .then((res) => {\n        if (res.status === 200) {\n          res.json().then((res) => {\n            dispatch(setLoginUser(res.userId));\n            if (currentDocument) {\n              fetch(\"http://127.0.0.1:5000/getDocumentContent\", {\n                method: \"POST\",\n                credentials: \"include\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                },\n                body: JSON.stringify({\n                  userId: currentUser,\n                  fileId: currentDocument.fileId,\n                }),\n              })\n                .then((res) => {\n                  if (res.status === 200) {\n                    res.json().then((res) => {\n                      setContent(res.fileContent);\n                      joinRoom();\n                      //if join room doesnt work just place join room as callback here and make apio call in joinroom\n                    });\n                  } else {\n                    res.json().then((res) => {\n                      alert(res.message);\n                    });\n                  }\n                })\n                .catch((err) => {\n                  alert(\n                    \"Failed to ftech the document content due to : \\n\",\n                    err.message\n                  );\n                });\n            }\n          });\n        } else {\n          let goToLogin = () => dispatch(\"/login\");\n          goToLogin();\n          dispatch(setLoginUser(\"\"));\n        }\n      })\n      .catch((err) => {\n        alert(err.message);\n      });\n  }, []);\n\n  if (!currentDocument) {\n    return <div>No document selected</div>;\n  }\n\n  const handleContentChange = (e) => {\n    setContent(e.target.value);\n    sendMessage(e.target.value);\n  };\n\n  const handleSave = () => {\n    fetch(\"http://127.0.0.1:5000/saveDocumentContent\", {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        userId: currentUser,\n        content: content,\n        fileId: currentDocument.fileId,\n      }),\n    }).then((res) => {\n      if (res.status === 200) {\n        res.json().then((res) => {\n          dispatch(\n            updateDocumentContent({\n              fileId: currentDocument.fileId,\n              newContent: content,\n            })\n          );\n          setAcknowledgment(res.message);\n          setTimeout(() => setAcknowledgment(\"\"), 3000);\n        });\n      } else {\n        res.json().then((res) => {\n          alert(res.message);\n        });\n      }\n    });\n  };\n\n  return (\n    <div className=\"edit-document\">\n      <div className=\"document-info\">\n        <h2>Document Editor</h2>\n        <p>\n          <strong>File Name:</strong> {currentDocument.fileName}\n        </p>\n        <p>\n          <strong>File ID:</strong> {currentDocument.fileId}\n        </p>\n        {currentDocument.ownerName && (\n          <p>\n            <strong>Owner:</strong> {currentDocument.ownerName}\n          </p>\n        )}\n        {roomMessage.length !== 0 ? <p>{roomMessage}</p> : <></>}\n        {currentDocument.sharedUsers && (\n          <div>\n            <strong>Shared With:</strong>\n            <ul>\n              {currentDocument.sharedUsers.map((user, index) => (\n                <li key={index}>\n                  {user.userId} - {user.permissions.join(\", \")}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n      <div className=\"editor\">\n        <textarea\n          className=\"editor-textarea\"\n          placeholder=\"Start writing your document here...\"\n          value={content}\n          onChange={handleContentChange}\n        ></textarea>\n      </div>\n      <div className=\"editor-actions\">\n        <button className=\"save-button\" onClick={handleSave}>\n          Save\n        </button>\n      </div>\n      {acknowledgment && <div className=\"acknowledgment\">{acknowledgment}</div>}\n    </div>\n  );\n};\n\nexport default EditDocument;\n\n// https://codesandbox.io/s/slate-react-rich-text-editor-fbqre?file=/src/App.js\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}